---
title: "Population level models"
description: |
  Fitting and choosing the best fitted model to disease progress curve data obtained in replicated experiments.
---

# Introduction

## Cálculos com modelos

A formulação linear dos modelos de progresso de doença podem ser utilizados para predizer a intensidade da doença em qualquer tempo, determinar o valor dao parâmetro de taxa e avaliar o efeito da mudança da intensidade inicial da doença e o parâmetro de taxa no desenvolvimento da doença. O modelo linearizado mostrado anteriormente consiste de quatro termos:

-   a transformação da intensidade inicial da doença
-   a taxa de aumento (slope)
-   um período de tempo além do tempo inicial (t)
-   a transformação da intensidade da doença em um determinado período de tempo (y\*)

Nos cálculos abaixo, três dos quatro termos são conhecidos e deve-se solucionar o quarto termo.

### Calcula y

Considere: Modelo exponencial com taxa rE = 0.1

```{r}
t1=10 # tempo inicial (t1)
t2=20 # tempo final (t2) e que se quer determinar y
rE = 0.1 # taxa do modelo exponencial
yt1=0.01 # o valor do y no tempo inicial

yt2 = log(yt1) + rE*(t2-t1) # equação linear 
yt2 # linearizado com valor em logaritmo
exp(yt2) #  destranformando (volta a escala original)
```

### Calcula y0

No tempo de 35 dias, a intensidade é 0.16 (y35 = 0.16) e a taxa é 0.15/dia. Considere o modelo logístico.

```{r}
y35 = 0.16
rL = 0.15
t=35

y=log(0.16/0.84)-rL*t
y
y0=1/(1+exp(-y))
y0

# Faz o gráfico do modelo logístico para uma epidemia de duração de 100 dias
curve(1 / ( 1 + ((1-y0)/y0)*exp(-rL*x)), from=0,to=100,xlab='t',ylab='y', col='black',lwd=3)

```

### Calcula tempo para y

Outra possibilidade de cálculo é o de quanto tempo leva para atingir um determinado valor `yt2`, sabendo o valor de `yt1` em um tempo `t1` anterior conhecido.

```{r}
yt2 = 0.05    # y no tempo2
t1 = 10       # tempo inicial
yt1 = 0.01    # y no tempo inicial
rE = 0.1      # taxa do modelo exponencial

t = (log(yt2)-log(yt1))/rE # calcula o número de dias após o tempo incial
t

t2 = t1 + t  # soma com t1 para estimar o tempo após o início da epidemia
t2 

```

No gráfico abaixo, a linha tracejada indica o `t1` e `t2`, ou o tempo após o início da epidemia, estimado em 26 dias, segundo calculado acima.

```{r}
yt0 = 0.0036 # y0 calculado anteriormente
curve(yt0*exp(rE*x), from=0,to=40,xlab='t',ylab='y', col='black',lwd=3)
abline (v=t1, lty=2) # coloca a linha vertical 
abline (v=t2, lty=2)

text (t1, yt1, "t1", pos=4) # cooca o texto 
text (t2, yt2, "t2", pos=4)
text (10, 0.1, "16 dias para atingir y=0.05", pos=4)
```

### r entre dois tempos

Uma outra possibilidade de cálculo é o da **taxa do modelo conhecendo-se o valor de `y` em dois tempos**: `yt1` e `yt2`. O rearranjo da equação que permite calcular `rE` é dado por:

::: {align="center"}
$r_E$ =$\dfrac{ln(y_{t_2}) - ln(y_{t_1})}{t_2 - t_1}$,

`rE = (log(yt2) - log(yt1))/(t2-t1)` ,
:::

<p>

Onde, `yt2` e `yt1` são a intensidade da doença nos dois tempos `t2` e `t1`, respectivamente.

<p>

<br>

```{r}

yt2 = 0.05    # intensidade da doença no tempo 2
yt1 = 0.01    # intensidade da doença no tempo 1
t1=10         # tempo 1
t2=30         # tempo 2

rE = ( log(yt2) - log(yt1) ) /(t2-t1)
rE            # taxa absoluta entre dois tempos

```
