# Spatial gradients

::: {.callout-note appearance="simple"}
This is a work in progress that is currently undergoing heavy technical editing and copy-editing
:::

## Introduction

The assessment of disease in space, in terms of changes in the intensity as it spreads over distance, is called **disease gradient**. In reality, it is the dispersal (migration) of the pathogen by various means (e.g. wind, vectors, rain, movement of infected material or human mediation) that promotes the spread of plant diseases within a field or across continents and generates the disease gradients. There are two kinds of gradients, the inoculum gradient where host availability is not necessarily required and the disease gradient where the three elements of the disease triangle are required. Let's see examples of actual disease gradients measured in the field with quite distinct patterns.

In the first example [@mundt1999], the objective of the authors was to measure the dispersal potential of the pathogenic bacteria *Xanthomonas oryzae* pv. *oryzae* that causes leaf blight on rice using experimental plots in the Philippines, during the wet seasons of 1994 and 1995. The data were made available [in this tutorial](https://www.apsnet.org/edcenter/disimpactmngmnt/topc/EcologyAndEpidemiologyInR/ModelingDispersalGradients/Pages/PrimaryDiseaseGradientsofBacteria.aspx). We enter the data manually and then produce two plots, one for each year.

```{r}
#| warning: false
#| message: false
library(tidyverse)
theme_set(theme_bw())
d <- c(0.0, 0.22, 0.44, 0.66) # distance in meters
y4 <- c(3.083, 0.521, 0.083, 0.021) # n. of new lesions in 1994 trial
y5 <- c(7.185, .380, 0.157, 0.028) # n. of new lesion in 1995 trial
xo <- data.frame(d, y4, y5)

g1 <- xo |> 
  ggplot(aes(d, y4))+
  geom_point()+
  geom_line()+
  labs(y = "N. of new lesions",
       x = "Distance (m)",
       title = "1994 wet season")

g2 <- xo |> 
  ggplot(aes(d, y5))+
  geom_point()+
  geom_line()+
  labs(y = "N. of new lesions",
       x = "Distance (m)",
       title = "1995 wet season")

library(patchwork)
(g1 | g2) +  plot_annotation(
  title = 'Primary gradients of bacterial blight of rice',
  caption = "Source: Mundt et al. (1999)")
  




```

The second gradient is of stripe rust, caused by *Puccinia striiformis* f. sp. *tritici,* on wheat collected in a field experiment at Hermiston in 2002 [@Sackett2005] and whose data was made freely available [@mikaberidze2015]. Let's enter data manually as a tibble format. There are five columns. The first and second are distances in feet and meters, respectively, from the source of infection. The other three columns are measures of stripe rust severity on replicated plots.

```{r}
hermiston <- tibble::tribble(
               ~dist_f, ~dist_m,  ~`1`,  ~`2`,  ~`3`,
                    0L,       0,    65,    65,    39,
                    5L,     1.5,    35,    44,   7.5,
                   10L,       3,  21.5,  14.5,  1.75,
                   20L,     6.1,     8,  0.75,   0.2,
                   40L,    12.2,     1,  0.08, 0.025,
                   60L,    18.3,  0.25, 0.026, 0.015,
                   80L,    24.4, 0.035, 0.015, 0.009,
                  100L,    30.5,  0.01, 0.003, 0.008,
                  120L,    36.6, 0.008, 0.016,  0.01,
                  140L,    42.7, 0.003, 0.003,  0.01,
                  160L,    48.8, 0.001, 0.006, 0.006,
                  180L,    54.9, 0.001, 0.002, 0.002,
                  200L,      61, 0.001, 0.003, 0.004,
                  220L,    67.1, 0.001, 0.003, 0.002,
                  240L,    73.2, 0.001, 0.001,     0,
                  260L,    79.2, 0.001, 0.002,     0,
                  280L,    85.3, 0.001, 0.001,     0,
                  300L,    91.4, 0.001, 0.001, 0.001
               )


```

```{r}
#| warning: false
library(tidyverse)
library(ggthemes)
theme_set(theme_bw())
hermiston |> 
  pivot_longer(3:5, names_to = "replicate", values_to = "severity") |> 
  ggplot(aes(dist_m, severity, color = replicate))+
  geom_point(size = 2)+
  geom_line(size = 1)+
  scale_color_colorblind()+
  labs(title = "Primary disease gradients", 
       x = "Distance from the source (m)",
       y = "Stripe rust severity (%)",
       color = "Replicate",
       caption = "source: Sackett et al. (2005)")
```

As it is clear in the above examples, in disease gradients, assuming that there is only a single source of inoculum, the intensity of the disease decreases more steeply within short distances of the source, and less steeply at greater distances until they reach zero or a low background level of occasional diseased plants.

The shapes of the gradients are defined by mechanisms associated with the dispersal of the inoculum which depends on the biology of the pathogen but strongly to environmental factors that affect pathogen dispersal.

When studying disease gradients, researchers need to make sure that there is a well-defined single source of inoculum. In gradients, this is called a **focus** (where foci are deemed the plural), from where the inoculum originates. Three types of foci can be defined: point, line or area sources. While the point source can be a plant or group of plants at any position in the plot or field (center or corner), line and area sources are usually defined as one or more rows of diseased plants at one side of the plot or field.

```{r}
#| code-fold: true
library(ggplot2)
library(gganimate)
line <- ggplot(data.frame(c(1:10),c(1:10)))+
  annotate("rect", xmin = 0, xmax = 10, ymin = 0, ymax = 10, fill = "gray92")+
  annotate("rect", xmin = 0, xmax = 10, ymin = 9.7, ymax = 10, color = "black", fill = "orange")+
  annotate("segment", size = 2, x = 1, xend = 1, y = 9.5, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 3, xend = 3, y = 9.5, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 5, y = 9.5, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 7, xend = 7, y = 9.5, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 9, xend = 9, y = 9.5, yend = 2, arrow = arrow())+
  ylim(0,10)+
  xlim(0,10)+
  coord_fixed()+
  theme_void()+
  labs(title = "      Side line")

area <- ggplot(data.frame(c(1:10),c(1:10)))+
  annotate("rect", xmin = 0, xmax = 10, ymin = 0, ymax = 10, fill = "gray92")+
  annotate("rect", xmin = 0, xmax = 10, ymin = 8.2, ymax = 10, color = "black", fill = "orange")+
  annotate("segment", size = 2, x = 1, xend = 1, y = 8, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 3, xend = 3, y = 8, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 5, y = 8, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 7, xend = 7, y = 8, yend = 2, arrow = arrow())+
  annotate("segment", size = 2, x = 9, xend = 9, y = 8, yend = 2, arrow = arrow())+
  ylim(0,10)+
  xlim(0,10)+
  coord_fixed()+
  theme_void()+
  labs(title = "      Side area")

point_central <- ggplot(data.frame(c(1:10),c(1:10)))+
  annotate("rect", xmin = 0, xmax = 10, ymin = 0, ymax = 10, fill = "gray92")+
  annotate("segment", size = 2, x = 5, xend = 10, y = 5, yend = 10, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 10, y = 5, yend = 5, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 10, y = 5, yend = 0, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 0, y = 5, yend = 0, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 0, y = 5, yend = 5, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 0, y = 5, yend = 10, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 5, y = 5, yend = 10, arrow = arrow())+
  annotate("segment", size = 2, x = 5, xend = 5, y = 5, yend = 0, arrow = arrow())+
   annotate("rect", xmin = 5.5, xmax = 4.5, ymin = 4.5, ymax = 5.5, color = "black", fill = "orange" )+
  ylim(0,10)+
  xlim(0,10)+
  coord_fixed()+
  theme_void()+
  labs(title = "    Central point/area")

point_corner <- ggplot(data.frame(c(1:10),c(1:10)))+
  annotate("rect", xmin = 0, xmax = 10, ymin = 0, ymax = 10, fill = "gray92")+
  annotate("segment", size = 2, x = 0, xend = 10, y = 10, yend = 0, arrow = arrow())+
  annotate("segment", size = 2, x = 0, xend = 6.6, y = 10, yend = 0, arrow = arrow())+
  annotate("segment", size = 2, x = 0, xend = 3.3, y = 10, yend = 0, arrow = arrow())+
  annotate("segment", size = 2, x = 0, xend = 0, y = 10, yend = 0, arrow = arrow())+
  annotate("segment", size = 2, x = 0, xend = 10, y = 10, yend = 3.3, arrow = arrow())+
  annotate("segment", size = 2, x = 0, xend = 10, y = 10, yend = 6.6, arrow = arrow())+
  annotate("segment", size = 2, x = 0, xend = 10, y = 10, yend = 10, arrow = arrow())+
  annotate("rect", xmin = 0, xmax = 1, ymin = 9, ymax = 10, color = "black", fill = "orange")+
  ylim(0,10)+
  xlim(0,10)+
  coord_fixed()+
  theme_void()+
  labs(title = "    Corner point/area")

library(patchwork)
p_gradients <- (line | area)/
(point_central | point_corner)

ggsave("imgs/gradients.png", width =9, height =9, bg = "white")


```

![](imgs/gradients.png){width="584"}

The resulting gradients can be classified in two types: primary or secondary. The primary gradient originates only from the initial focus, while the secondary gradient originates from the movement of inoculum produced at previously infected (due to primary gradients) plants to other plants at increasing distances from the source. It is expected that a mix of both kinds of gradients exists as the disease increases over time.

As an example of primary and secondary gradients, let's visualize the gradients of Septoria leaf spot, caused by *Septoria lycopersici*, on tomato [@parker1997]. The gradients were measured during two times, thus enabling a comparison of primary and secondary dispersal/disease gradients. More details of the study and experimental approach were provided in [this tutorial.](https://www.apsnet.org/edcenter/disimpactmngmnt/topc/EcologyAndEpidemiologyInR/ModelingDispersalGradients/Pages/PrimaryandSecondaryGradients.aspx) The data is entered below as a tribble and the plot produced using g*gplot2*.

```{r}
septoria <- tibble::tribble(
                ~d, ~date1, ~date4,
               60,    75,    87,
              120,    40,    78,
              180,    30,    68,
              240,    20,    62,
              300,    15,    50,
              360,    12,    27,
              420,    10,    32,
              480,    12,    12,
              540,     8,    13,
              600,     5,     5,
              660,     4,     4
              )

septoria |> 
  pivot_longer(2:3, names_to = "date", 
               values_to = "defoliation") |> 
  ggplot(aes(d, defoliation, color = date))+
  geom_point()+
  geom_line()+
  scale_color_colorblind()+
  annotate(geom = "text", x = 200, y = 12, 
           label = "Primary gradient", hjust = "left")+
   annotate(geom = "text", x = 200, y = 72, 
           label = "Secondary gradient", hjust = "left")+
  labs(title = "Disease gradients",
       subtitle = "Septoria leaf spot on tomato",
       x = "Distrance from focus (m)",
       y = "Percent defoliation",
       color = "Date",
       caption = "Parker et al. (1997)")

```

## Gradient models

Similar to disease progress curves, models can be fitted empirically to observed disease gradient curves and provide insights into the mechanisms of inoculum dispersal and deposition, the source of inoculum, and the physical processes underlying dispersal.

When modeling disease gradients, the distance is represented by $x$, a continuous variable which can be expressed by various units (cm, m, km, etc). The gradient models, similar to the population dynamics models (disease progress) are of the **deterministic** type. The difference is that, for disease progress curves, disease intensity tends to increase with increasing time, while in disease gradients the disease intensity tends to decrease with increasing distance from the source of inoculum. Two models are most commonly fitted to data on disease gradients. More details about these models can be obtained it [this tutorial.](https://www.apsnet.org/edcenter/disimpactmngmnt/topc/EcologyAndEpidemiologyInR/ModelingDispersalGradients/Pages/default.aspx)

### Exponential model

The exponential model is also known as Kiyosawa & Shiyomi model. The differential of the exponential model is given by

$\frac{dy}{dx}$ = $-b_{E}.y$ ,

where $b_{E}$ is the exponential form of the rate of decline and $y$ is the disease intensity. This model suggests that $y$ (any disease intensity) is greater close to the source of inoculum, or at the distance zero. The integral form of the model is given by

$y = a . e^{-b.x}$ ,

where $a$ is the disease intensity at the distance zero and $b$ is the rate of decline, in this case negative because disease intensity decreases with the increase of the distance from inoculum source. Let's make a plot for two disease gradients of varying parameters for this model.

First we need to load essential packages for programming, customizing the outputs and defining a global ggplot theme.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(ggthemes)
library(patchwork)
library(cowplot) # for themes 
theme_set(theme_bw(base_size = 16)) # set global theme
```

Set the parameters for the exponential model with two rates and same inoculum at the source:

```{r}
a1 <- 0.2 # y at distance zero for gradient 1
a2 <- 0.2 # y at distance zero for gradient 2
b1 <- 0.1 # decline rate for gradient 1
b2 <- 0.05 # decline rate for gradient 2
max1 <- 80 # maximum distance for gradient 1
max2 <- 80 # maximum distance for gradient 2
dat <- data.frame(x = seq(1:max1), y = seq(0:a1))
```

The following code allows to visualize the model predictions.

```{r}

dat |>
  ggplot(aes(x, y)) +
  stat_function(fun = function(x) a1 * exp(-b1 * x), linetype = 1) +
  stat_function(fun = function(x) a2 * exp(-b2 * x), linetype = 2) +
  ylim(0, a1) +
  annotate("text", x = 20, y = 0.04, label = "b = 0.1") +
  annotate("text", x = 20, y = 0.10, label = "b = 0.05") +
  labs(
    title = "Exponential model",
    subtitle = "",
    x = "Distance (m)",
    y = "Disease incidence (proportion)"
  )
```

### Power law model

Also known as the modified Gregory's model (Gregory was a pioneer in the use this model to describe plant disease gradients). In the power law model, $Y$ is proportional to the power of the distance, and is given by:

$Y = a_{P}.x - b_{P}$

where $a_{P}$ and $b_{P}$ are the two parameters of the power law model. They differ from the exponential because as closer to $x$ is to zero, $Y$ is indefinitely large (not meaningful biologically). However, the model can still be useful because it produces realistic values at any distance $x$ away from the source. The values of the $a_{P}$ parameter should be interpreted in accord to the scale of $x$, whether in centimeters or meters. If the distance between the source and the first measure away from the source is 0.5m, it is so more appropriate to record the distance in cm than in m or km.

Once $y$ at the distance zero from the source is undefined when using the power law model, this is usually modified by the addition of a positive constant $C$ in $x$:

$Y = a_{P}.(x + C) - b_{P}$

For this reason, the model is named as the modified power law. Here, the constant $C$ is of the same unit of $x$. At the distance zero, the positive constant is a term that express the size of the inoculum source. In other words, the $a$ parameter is a theoretical value of $Y$ at the distance $1-C$ from the center of the inoculum source.

Let's plot two gradients with two rate parameters for the modified power law model:

```{r}
C <- 0.5
a1 <- 0.2 # y at zero distance for gradient 1
a2 <- 0.2 # y at zero distance for gradient 2
b1 <- 0.5 # decline rate for gradient 1
b2 <- 0.7 # decline rate for gradient 2
max1 <- 80 # maximum distance for gradient 1
max2 <- 80 # maximum distance for gradient 2
dat2 <- data.frame(x = seq(1:max1), y = seq(0:a1))


dat2 |>
  ggplot(aes(x, y)) +
  stat_function(fun = function(x) a1 * ((x + C)^-b1), linetype = 1) +
  stat_function(fun = function(x) a2 * ((x + C)^-b2), linetype = 2) +
  ylim(0, a1 - 0.02) +
  annotate("text", x = 20, y = 0.03, label = "b = 0.1") +
  annotate("text", x = 20, y = 0.06, label = "b = 0.05") +
  labs(
    title = "Modified Power Law",
    subtitle = "",
    x = "Distance (m)",
    y = "Disease incidence"
  )
```

The differential equation of the power law model is given by:

$\frac{dy}{dx}$ = $\frac{-b_{P}.Y}{x - C}$

Similar to the exponential model, $\frac{dy}{dx}$ is proportional to $Y$, meaning that the gradient is steeper (more negative) at the highest disease intensity value, usually closer to the source.

## Linearization of the models

### Transformations of y

The gradient models, again similar to the temporal disease models, are **non linear in their parameters**. The model is intrinsically linear if transformations are applied (according to the model) in both sides of the equations. The linear model in its generic state is given by

$y* = a* + bx$ ,

where the asterisk in $a$ indicated that one of the transformations was applied in $y$ that produced the linear model. Note that $a*$ is the transformed version of the initial disease intensity, which needs to be returned to the original scale according to the respective back-transformation. Follows the linearized form of the two most common gradient models.

$ln(y) = ln(a_{E}) - b_{E}. x$

$ln(y) = ln(a_{P}) - b_{E}. ln(x+C)$

### Plot for the linearized form of models

Let's visualize the linearization of the exponential model with two different slopes (gradient 1 and 2). Note that the transformation used was $ln(y)$.

Follows the linearization of the modified power law model.

```{r}
C <- 0.5
a1 <- 0.2 # y at zero distance for gradient 1
a2 <- 0.2 # y at zero distance for gradient 2
b1 <- 0.5 # decline rate for gradient 1
b2 <- 0.7 # decline rate for gradient 2
max1 <- 80 # maximum distance for gradient 1
max2 <- 80 # maximum distance for gradient 2
dat2 <- data.frame(x = seq(1:max1), y = seq(0:a1))

dat2 |>
  ggplot(aes(x, y)) +
  stat_function(fun = function(x) log(a1) - (b1 * x), linetype = 1) +
  stat_function(fun = function(x) log(a2) - (b2 * x), linetype = 2) +
  labs(
    title = "Exponential",
    subtitle = "",
    x = "log of distance (m)",
    y = "log of disease incidence"
  )
```

Follows the linearization of the modified power law model. Note that the transformation used was $ln(y)$ and $ln(x+C)$ .

```{r}
C <- 0.5
a1 <- 0.2 # y at zero distance for gradient 1
a2 <- 0.2 # y at zero distance for gradient 2
b1 <- 0.5 # decline rate for gradient 1
b2 <- 0.7 # decline rate for gradient 2
max1 <- log(80) # maximum distance for gradient 1
max2 <- log(80) # maximum distance for gradient 2
dat2 <- data.frame(x = seq(1:max1), y = seq(0:a1))

dat2 |>
  ggplot(aes(x, y)) +
  stat_function(fun = function(x) log(a1) - (b1 * log(x + C)), linetype = 1) +
  stat_function(fun = function(x) log(a2) - (b2 * log(x + C)), linetype = 2) +
  labs(
    title = "Modified Power Law",
    subtitle = "",
    x = "log of distance (m)",
    y = "log of disease incidence"
  )
```
